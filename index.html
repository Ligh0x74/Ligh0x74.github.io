<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Ligh0x74&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Ligh0x74&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Ligh0x74&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Ligh0x74&#039;s Blog"><meta property="og:url" content="https://ligh0x74.github.io/"><meta property="og:site_name" content="Ligh0x74&#039;s Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://ligh0x74.github.io/img/og_image.png"><meta property="article:author" content="Ligh0x74"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://ligh0x74.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ligh0x74.github.io"},"headline":"Ligh0x74's Blog","image":["https://ligh0x74.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Ligh0x74"},"publisher":{"@type":"Organization","name":"Ligh0x74's Blog","logo":{"@type":"ImageObject","url":"https://ligh0x74.github.io/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Ligh0x74&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-08-14T04:01:18.128Z" title="2024/8/14 下午12:01:18">2024-08-14</time>发表</span><span class="level-item"><time dateTime="2024-08-14T04:05:21.458Z" title="2024/8/14 下午12:05:21">2024-08-14</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%B3%BB%E7%BB%9F/">系统</a></span><span class="level-item">6 分钟读完 (大约855个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/14/%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%20%E8%AF%BE%E7%A8%8B%202022/">南京大学 操作系统 课程 2022</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://jyywiki.cn/OS/2022/index.html">课程网站</a>，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Cm4y1d7Ur/">课程视频</a>，<a target="_blank" rel="noopener" href="https://pages.cs.wisc.edu/~remzi/OSTEP/">OSTEP</a>，<a target="_blank" rel="noopener" href="https://csapp.cs.cmu.edu/">CSAPP</a>。</p>
<h2 id="Part-1">Part 1</h2>
<p>资料：<a target="_blank" rel="noopener" href="https://www.cs.drexel.edu/~bls96/eniac/">ENIAC Simulator and Related Material</a>。</p>
<p>The special problem we tried to get at with these lectures was to maintain the interest of the very enthusiastic and rather smart students coming out of the high schools and into Caltech. They have heard a lot about how interesting and exciting physics is—the theory of relativity, quantum mechanics, and other modern ideas. By the end of two years of our previous course, many would be very discouraged because there were really very few grand, new, modern ideas presented to them. They were made to study inclined planes, electrostatics, and so forth, and after two years it was quite stultifying. The problem was whether or not we could make a course which would save the more advanced and excited student by maintaining his enthusiasm. (<a target="_blank" rel="noopener" href="https://www.feynmanlectures.caltech.edu/">The Feynman Lectures on Physics</a>)</p>
<p>思考 Why - What - How，<strong>为什么 - 是什么 - 怎么做</strong>。</p>
<p>Operating System: A body of software, in fact, that is responsible for <em>making it easy to run programs</em> (even allowing you to seemingly run many at the same time), allowing programs to share memory, enabling programs to interact with devices, and other fun stuff like that. (OSTEP)</p>
<p>关键问题：操作系统如何发展成现在这样的？（硬件、软件）</p>
<hr>
<p>工具：<code>gdb</code>，<code>strace</code>。（<code>tldr</code>，<code>xxd</code>）</p>
<p>资料：<a target="_blank" rel="noopener" href="https://vimhelp.org/">Vim help files</a>，<a target="_blank" rel="noopener" href="https://jyywiki.cn/pages/OS/2022/demos/logisim.c">logisim.c</a>，<a target="_blank" rel="noopener" href="https://jyywiki.cn/pages/OS/2022/demos/seven-seg.py">seven-seg.py</a>，<a target="_blank" rel="noopener" href="https://jyywiki.cn/pages/OS/2022/demos/minimal.S">minimal.S</a>。</p>
<p>以下代码是 <code>logisim.c</code> 的简化版，实现数字逻辑电路的模拟器。我们可以在 <code>vim</code> 中使用 <code>!gcc % &amp;&amp; ./a.out</code> 命令，运行如下代码。代码中使用 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X_macro">X macro</a> 技巧，我们可以使用 <code>!gcc -E %</code> 命令输出宏展开之后的代码。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REGS_FOREACH(_)  _(X) _(Y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RUN_LOGIC        X1 = !X &amp;&amp; Y; \</span></span><br><span class="line"><span class="meta">                         Y1 = !X &amp;&amp; !Y;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFINE(X)        static int X, X##1;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UPDATE(X)        X = X##1;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT(X)         printf(#X <span class="string">&quot; = %d; &quot;</span>, X);</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  REGS_FOREACH(DEFINE);</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123; <span class="comment">// clock</span></span><br><span class="line">    RUN_LOGIC;</span><br><span class="line">    REGS_FOREACH(PRINT);</span><br><span class="line">    REGS_FOREACH(UPDATE);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>); sleep(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;                                      </span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> X, X1; <span class="type">static</span> <span class="type">int</span> Y, Y1;;            </span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;                                     </span><br><span class="line">    X1 = !X &amp;&amp; Y; Y1 = !X &amp;&amp; !Y;;                                                                    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;X&quot;</span> <span class="string">&quot; = %d; &quot;</span>, X); <span class="built_in">printf</span>(<span class="string">&quot;Y&quot;</span> <span class="string">&quot; = %d; &quot;</span>, Y);;                                             </span><br><span class="line">    X = X1; Y = Y1;;                              </span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>); sleep(<span class="number">1</span>);                      </span><br><span class="line">  &#125;                                               </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程序 <code>seven-seg.py</code> 使用 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI escape code</a> 来控制字符的颜色。<code>\033[37m</code> 和 <code>\033[31m</code> 分别表示，将当前和之后的字符设置为白色、红色，而 <code>\033[0m</code> 表示重置设置。<code>\033[2J</code> 表示清空屏幕同时将光标移至左上角，<code>\033[1;1f</code> 表示将光标移至第 1 行和第 1 列（应该是这样，HVP 和 CUP 的区别没看懂）。最后，我们可以使用管道，将 <code>logisim.c</code> 的输出作为 <code>seven-seg.py</code> 的输入，从而模拟数码管的显示（执行 <code>./a.out | python3 seven-seg.py</code> 命令）。</p>
<p>彩蛋：<code>telnet towel.blinkenlights.nl</code>（命令行电影），<code>ssh sshtron.zachlatta.com</code>（网络游戏）。（使用 ANSI escape code 实现）</p>
<p>关键概念：<strong>程序是状态机</strong>。可以从以下两个视角，抽象的理解。</p>
<ul>
<li>
<p>源代码视角：状态 = 栈帧列表（每个栈帧都有 PC）+ 全局变量。</p>
</li>
<li>
<p>二进制视角：状态 = 寄存器 + 内存，程序 = 计算指令 + syscall 指令。</p>
</li>
</ul>
<p>问题：如何构造一个最小的 “Hello, World” 程序？（RTFM，<code>man syscall</code>）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">.globl _start</span><br><span class="line">_start:</span><br><span class="line">  movq $SYS_write, %rax   <span class="comment">// write(</span></span><br><span class="line">  movq $<span class="number">1</span>,         %rdi   <span class="comment">//   fd=1,</span></span><br><span class="line">  movq $st,        %rsi   <span class="comment">//   buf=st,</span></span><br><span class="line">  movq $(ed - st), %rdx   <span class="comment">//   count=ed-st</span></span><br><span class="line">  syscall                 <span class="comment">// );</span></span><br><span class="line"></span><br><span class="line">  movq $SYS_exit,  %rax   <span class="comment">// exit(</span></span><br><span class="line">  movq $<span class="number">1</span>,         %rdi   <span class="comment">//   status=1</span></span><br><span class="line">  syscall                 <span class="comment">// );</span></span><br><span class="line"></span><br><span class="line">st:</span><br><span class="line">  .ascii <span class="string">&quot;\033[01;31mHello, OS World\033[0m\n&quot;</span></span><br><span class="line">ed:</span><br></pre></td></tr></table></figure>
<hr>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-08-12T14:19:35.532Z" title="2024/8/12 下午10:19:35">2024-08-12</time>发表</span><span class="level-item"><time dateTime="2024-08-13T01:48:48.624Z" title="2024/8/13 上午9:48:48">2024-08-13</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%AE%9E%E9%AA%8C/">实验</a></span><span class="level-item">7 分钟读完 (大约1004个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/12/%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%20%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C%202022/">南京大学 计算机系统基础 课程实验 2022</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://nju-projectn.github.io/ics-pa-gitbook/ics2022/">实验网站</a>，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1qa4y1j7xk/">2020 南京大学计算机系统基础习题课</a>。</p>
<h2 id="PA0-世界诞生的前夜-开发环境配置">PA0 - 世界诞生的前夜: 开发环境配置</h2>
<p>使用 <code>vimtutor</code> 命令启动 <code>vim</code> 教程。</p>
<p>教程：<a target="_blank" rel="noopener" href="https://nju-projectn.github.io/ics-pa-gitbook/ics2022/linux.html">GNU/Linux</a>，<a target="_blank" rel="noopener" href="https://makefiletutorial.com/">Makefile</a>，<a target="_blank" rel="noopener" href="https://www.cprogramming.com/gdb.html">GDB</a>，<a target="_blank" rel="noopener" href="https://hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/">tmux</a>，<a target="_blank" rel="noopener" href="https://nju-projectn.github.io/ics-pa-gitbook/ics2022/git.html">Git</a>，<a target="_blank" rel="noopener" href="https://docs.huihoo.com/c/linux-c-programming/">Linux C编程一站式学习</a>。</p>
<p>课程：<a target="_blank" rel="noopener" href="https://missing.csail.mit.edu/">The Missing Semester of Your CS Education</a>。</p>
<p>其他：<a target="_blank" rel="noopener" href="https://onlywei.github.io/explain-git-with-d3/">Visualizing Git Concepts with D3</a>。</p>
<p>使用 <code>apt-get install</code> 经常遇到 “The following packages have unmet dependencies” 错误，原因是因为依赖的包和现有的包版本冲突，之前我都是手动 <code>apt-get remove</code>，但是经常遇到该问题。STFW 之后，<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/26571326/how-do-i-resolve-the-following-packages-have-unmet-dependencies">这里</a>推荐的 <code>aptitude</code> 工具比较方便，发生冲突时会询问是否降级。（<code>apt-get</code>，<code>aptitude</code>，<code>apt</code> 的区别，是否有必要使用 <code>aptitude</code>？<a target="_blank" rel="noopener" href="https://www.reddit.com/r/debian/comments/19fdqz3/whats_better_apt_aptget_or_aptitude/">讨论</a>。）</p>
<p>使用 <code>make</code> 经常遇到 “No such file or directory” 之类缺失头文件的错误，目前是遇到两种情况。一种是缺失对应的包，直接 <code>apt-get install</code> 即可解决；另一种是有对应的包，但是当前项目中 <code>.mk</code> 文件配置的程序名称和现有名称不一致（例如，配置的是 <code>llvm-config</code>，而现有的是 <code>llvm-config-11</code>），修改 <code>.mk</code> 文件即可解决。</p>
<h2 id="PA1-开天辟地的篇章-最简单的计算机">PA1 - 开天辟地的篇章: 最简单的计算机</h2>
<p>手册：<a target="_blank" rel="noopener" href="https://github.com/riscv/riscv-isa-manual">riscv-isa-manual</a>，<a target="_blank" rel="noopener" href="https://github.com/riscv-non-isa/riscv-elf-psabi-doc">riscv-elf-psabi-doc</a>，<a target="_blank" rel="noopener" href="https://nju-projectn.github.io/ics-pa-gitbook/ics2022/index.html#%E5%AE%98%E6%96%B9%E6%89%8B%E5%86%8C">etc</a>，<a target="_blank" rel="noopener" href="https://nju-projectn.github.io/ics-pa-gitbook/ics2022/nemu-isa-api.html">NEMU ISA API</a>。</p>
<p>可以在目标命令之前添加 <code>time</code> 命令，从而计算目标命令的执行时间。使用 <code>make</code> 命令的 <code>-j</code> 选项，可以启用多线程编译。<code>make -j4</code> 表示创建 4 个线程并行编译，具体创建多少个线程，可以根据 <code>lscpu</code> 命令查询得到的系统中的 CPU 数量来确定。使用 <code>ccache</code> 工具可以缓存目标文件，从而加速执行 <code>make clean</code> 之后，再次执行 <code>make</code> 的速度。</p>
<p>如何实现宏 <code>IFDEF</code> 和 <code>MUXDEF</code>。其中 <code>IFDEF</code> 表示，如果定义了 <code>CONFIG_DEVICE</code> 宏，才会调用 <code>init_device()</code> 函数。而 <code>MUXDEF</code> 表示，如果定义了 <code>CONFIG_TRACE</code> 宏，则预处理结果为 <code>ON</code>，否则预处理结果为 <code>OFF</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IFDEF(CONFIG_DEVICE, init_device());</span><br><span class="line">MUXDEF(CONFIG_TRACE, <span class="string">&quot;ON&quot;</span>, <span class="string">&quot;OFF&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>在 <code>nemu/include/macro.h</code> 文件中有如下定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// macro concatenation</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> concat_temp(x, y) x ## y</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> concat(x, y) concat_temp(x, y)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// macro testing</span></span><br><span class="line"><span class="comment">// See https://stackoverflow.com/questions/26099745/test-if-preprocessor-symbol-is-defined-inside-macro</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CHOOSE2nd(a, b, ...) b</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUX_WITH_COMMA(contain_comma, a, b) CHOOSE2nd(contain_comma a, b)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUX_MACRO_PROPERTY(p, macro, a, b) MUX_WITH_COMMA(concat(p, macro), a, b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// define placeholders for some property</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __P_DEF_0  X,</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __P_DEF_1  X,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// define some selection functions based on the properties of BOOLEAN macro</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MUXDEF(macro, X, Y)  MUX_MACRO_PROPERTY(__P_DEF_, macro, X, Y)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// simplification for conditional compilation</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __IGNORE(...)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __KEEP(...) __VA_ARGS__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// keep the code if a boolean macro is defined</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IFDEF(macro, ...) MUXDEF(macro, __KEEP, __IGNORE)(__VA_ARGS__)</span></span><br></pre></td></tr></table></figure>
<p>我们可以使用如下代码进行测试，同时给出宏展开的步骤。需要注意的是，只有当 <code>CONFIG_DEVICE</code> 被定义为 0 或 1 时，才会执行函数调用。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONFIG_DEVICE 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">init_device</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello, Linux World!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    IFDEF(CONFIG_DEVICE, init_device());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">IFDEF(CONFIG_DEVICE, init_device());</span><br><span class="line">IFDEF(<span class="number">1</span>, init_device());</span><br><span class="line">MUXDEF(<span class="number">1</span>, __KEEP, __IGNORE)(init_device());</span><br><span class="line">MUX_MACRO_PROPERTY(__P_DEF_, <span class="number">1</span>, __KEEP, __IGNORE)(init_device());</span><br><span class="line">MUX_WITH_COMMA(concat(__P_DEF_, <span class="number">1</span>), __KEEP, __IGNORE)(init_device());</span><br><span class="line">MUX_WITH_COMMA(__P_DEF_1, __KEEP, __IGNORE)(init_device());</span><br><span class="line">MUX_WITH_COMMA(X,, __KEEP, __IGNORE)(init_device());</span><br><span class="line">CHOOSE2nd(X, __KEEP, __IGNORE)(init_device());</span><br><span class="line">__KEEP(init_device());</span><br><span class="line">init_device();</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-14T07:56:20.438Z" title="2024/5/14 下午3:56:20">2024-05-14</time>发表</span><span class="level-item"><time dateTime="2024-05-14T08:05:34.472Z" title="2024/5/14 下午4:05:34">2024-05-14</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span> / </span><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/LeetCode/">LeetCode</a></span><span class="level-item">3 分钟读完 (大约486个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/14/%E7%AC%AC%20130%20%E5%9C%BA%E5%8A%9B%E6%89%A3%E5%A4%9C%E5%96%B5%E5%8F%8C%E5%91%A8%E8%B5%9B%EF%BC%88VP%EF%BC%89/">第 130 场力扣夜喵双周赛（VP）</a></p><div class="content"><h2 id="正方形中的最多点数"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-points-inside-the-square/">正方形中的最多点数</a></h2>
<h3 id="题目">题目</h3>
<p>输入长度为 \(n\) 的二维数组 \(points\) 和字符串 \(s\)，\(points[i]\) 表示第 \(i\) 个点的坐标，\(s[i]\) 表示第 \(i\) 个点的标签。如果以 \((0,0)\) 为中心且边平行于坐标轴的正方形内（包括边上的点，且边长可以为 \(0\)），不包含标签相同的两个点，则该正方形是合法的。输出合法正方形可以包含的最多点数。其中 \(points\) 中的点互不相同，\(s\) 只包含小写英文字母。</p>
<p>数据范围：\(1\leq n\leq 10^{5}\)，\(-10^{9}\leq points[i][0],points[i][1]\leq 10^{9}\)。</p>
<h3 id="思路">思路</h3>
<p>首先可以想到，正方形的边长越长，包含的点就越多，越可能不合法。具有单调性，可以使用二分求解。在二分的过程中，判断正方形是否合法，如果合法则更新答案。时间复杂度为 \(O(n\log{U})\)，其中 \(U=\max_{i=0}^{n-1}(|x_{i}|,|y_{i}|)\)。更好的做法是观察到，如果正方形包含某个点 \((x,y)\)，则正方形的边长 \(len\) 必须满足 \(len\geq 2\times\max(|x|,|y|)\)。其中，\(\max(|x|,|y|)\) 是点 \((x,y)\) 到点 \((0,0)\) 的切比雪夫距离。实际上，我们只需要维护每种标签点的最小切比雪夫距离 \(min_{i}\)，以及除此之外所有点的最小切比雪夫距离 \(k\)。因为，如果正方形包含某个标签 \(i\)，必定是包含具有该标签的切比雪夫距离最小的那个点，而这个点需要满足 \(min_{i}&lt;k\)。详情见代码，时间复杂度为 \(O(n)\)。优化思路参考<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-points-inside-the-square/solutions/2775310/er-fen-bian-chang-tong-shi-ji-lu-da-an-z-92w5/">灵神题解</a>。</p>
<h3 id="代码">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxPointsInsideSquare</span><span class="params">(<span class="type">int</span>[][] points, String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> points.length;</span><br><span class="line">        <span class="type">int</span>[] min = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">        Arrays.fill(min, Integer.MAX_VALUE);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> points[i][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> points[i][<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">z</span> <span class="operator">=</span> Math.max(Math.abs(x), Math.abs(y));</span><br><span class="line">            <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (z &lt; min[c]) &#123;</span><br><span class="line">                k = Math.min(k, min[c]);</span><br><span class="line">                min[c] = z;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k = Math.min(k, z);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x : min) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x &lt; k) &#123;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="分割字符频率相等的最少子字符串"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-substring-partition-of-equal-character-frequency/">分割字符频率相等的最少子字符串</a></h2>
<h3 id="题目-2">题目</h3>
<p>输入长度为 \(n\) 的字符串 \(s\)（只包含小写英文字母），输出 \(s\) 最少能被分割为多少个平衡子字符串。平衡字符串就是字符串中不同字符出现频次都相同的字符串。</p>
<p>数据范围：\(1\leq n\leq 1000\)。</p>
<h3 id="思路-2">思路</h3>
<p>定义 \(dp[i+1]\) 表示字符串 \([0,i]\) 最少能被分割的平衡子字符串数目，则转移方程为 \(dp[i+1]=\min(dp[j]+1)\)，其中 \(0\leq j\leq i\) 且字符串 \([j,i]\) 必须是平衡字符串。</p>
<h3 id="代码-2">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumSubstringsInPartition</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i + <span class="number">1</span>] = i + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>, max = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                k += cnt[s.charAt(j) - <span class="string">&#x27;a&#x27;</span>] == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">                max = Math.max(max, ++cnt[s.charAt(j) - <span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">                <span class="keyword">if</span> (i - j + <span class="number">1</span> == k * max) &#123;</span><br><span class="line">                    dp[i + <span class="number">1</span>] = Math.min(dp[i + <span class="number">1</span>], dp[j] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="大数组元素的乘积"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-products-of-elements-of-big-array/">大数组元素的乘积</a></h2>
<p>不会。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-13T11:03:22.872Z" title="2024/5/13 下午7:03:22">2024-05-13</time>发表</span><span class="level-item"><time dateTime="2024-05-13T11:20:12.867Z" title="2024/5/13 下午7:20:12">2024-05-13</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span> / </span><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/LeetCode/">LeetCode</a></span><span class="level-item">6 分钟读完 (大约857个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/13/%E7%AC%AC%20397%20%E5%9C%BA%E5%8A%9B%E6%89%A3%E5%91%A8%E8%B5%9B/">第 397 场力扣周赛</a></p><div class="content"><h2 id="矩阵中的最大得分"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-difference-score-in-a-grid/">矩阵中的最大得分</a></h2>
<h3 id="题目">题目</h3>
<p>输入一个 \(m\times n\) 的矩阵 \(grid\)，输出选择任意单元格作为起点，至少移动一次能够得到的最大得分。每次移动只能向正右方和正下方的单元格移动，不必相邻。假设从单元格 \((x_{1},y_{1})\) 移动到 \((x_{2},y_{2})\)，则本次移动的得分为 \(grid[x_{2}][y_{2}]-grid[x_{1}][y_{1}]\)。</p>
<p>数据范围：\(2\leq m,n\leq 1000\)，\(4\leq m\times n\leq 10^{5}\)，\(1\leq grid[i][j]\le 10^{5}\)。</p>
<h3 id="思路">思路</h3>
<p>比赛时想到计算过程存在重叠子问题，可以使用记忆化搜索。定义 \(f[i][j]\) 表示以 \((i,j)\) 为起点能够得到的最大得分，初始化 \(f[i][j]\) 为负无穷。当 \(i&lt;m-1\) 且 \(j&lt;n-1\) 时，状态转移方程为 \(f[i][j]=\max{(f[i+1][j]+grid[i+1][j]-grid[i][j],f[i][j+1])+grid[i][j+1]-grid[i][j]}\)。也可以将记忆化搜索转化为自底向上的形式，或者定义 \(f[i][j]\) 表示以 \((i,j)\) 为终点能够得到的最大得分。</p>
<p>通过观察可以发现，对于某个移动路径，得分只和起点和终点有关，中间的值都被抵消了。也就是说，某个起点能够得到的最大得分，是其右下角的最大值减去起点的值，反之亦然。所以也可以定义 \(f[i][j]\) 表示 \((i,j)\) 右下角的最大值或者左上角的最小值，然后进行递推。</p>
<p>时间复杂度为 \(O(mn)\)，空间复杂度为 \(O(mn)\)。<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-difference-score-in-a-grid/solutions/2774823/nao-jin-ji-zhuan-wan-dppythonjavacgo-by-swux7/">灵神题解</a>有个空间复杂度为 \(O(n)\) 的做法，思路是维护每列的最小值。</p>
<h3 id="代码">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxScore</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; grid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> grid.size(), n = grid.get(<span class="number">0</span>).size();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            Arrays.fill(dp[i], Integer.MIN_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(<span class="number">0</span>, <span class="number">0</span>, grid, dp);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                ans = Math.max(ans, dp[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, List&lt;List&lt;Integer&gt;&gt; grid, <span class="type">int</span>[][] dp)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> grid.size(), n = grid.get(<span class="number">0</span>).size();</span><br><span class="line">        <span class="keyword">if</span> (dp[x][y] == Integer.MIN_VALUE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x + <span class="number">1</span> &lt; m) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">diff</span> <span class="operator">=</span> grid.get(x + <span class="number">1</span>).get(y) - grid.get(x).get(y);</span><br><span class="line">                dp[x][y] = Math.max(dp[x][y], diff + dfs(x + <span class="number">1</span>, y, grid, dp));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (y + <span class="number">1</span> &lt; n) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">diff</span> <span class="operator">=</span> grid.get(x).get(y + <span class="number">1</span>) - grid.get(x).get(y);</span><br><span class="line">                dp[x][y] = Math.max(dp[x][y], diff + dfs(x, y + <span class="number">1</span>, grid, dp));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.max(<span class="number">0</span>, dp[x][y]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="找出分数最低的排列"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-the-minimum-cost-array-permutation/">找出分数最低的排列</a></h2>
<h3 id="题目-2">题目</h3>
<p>输入从 \(0\) 到 \(n-1\) 的一个排列 \(nums\)，输出从 \(0\) 到 \(n-1\) 的排列 \(perm\)，使得 \(score(perm)=\sum_{i=0}^{n-1}{|perm[i]-nums[perm[(i+1)\bmod n|}\) 的值最小。如果有多个满足条件的排列，则返回字典序最小的那个。</p>
<p>数据范围：\(2\leq n\leq 14\)。</p>
<h3 id="思路-2">思路</h3>
<p>通过观察可以发现，对于一个给定的排列 \(perm\)，将其循环移动不会改变 \(score(perm)\) 的值。要使满足条件的 \(perm\) 字典序最小，那么必然有 \(perm[0]=0\)。暴力的想法是枚举所有排列，但是时间复杂度为 \(n!\times n\)。由于枚举过程中，存在重复子问题，可以使用记忆化搜索来降低时间复杂度到 \(O(2^{n}n^{2})\)。定义 \(f[mask][pre]\) 表示已经选择集合 \(mask\) 中的数，上一个选择的数是 \(pre\)，剩余的数排列能够得到的最小分数。同理，定义 \(g[mask][pre]\) 表示下一个选择什么数能够使得分数最小，以及相同分数的排列字典序最小。可以看下<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-the-minimum-cost-array-permutation/solutions/2775272/zhuang-ya-dpcong-ji-yi-hua-sou-suo-dao-d-s9t5/">灵神题解</a>，不使用记忆化搜索，自底向上的解法也是非常经典的。</p>
<h3 id="代码-2">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findPermutation(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[][] f = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1</span> &lt;&lt; n][n];</span><br><span class="line">        <span class="type">int</span>[][] g = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1</span> &lt;&lt; n][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; (<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            Arrays.fill(f[i], -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            f[(<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>][i] = Math.abs(i - nums[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(<span class="number">1</span>, <span class="number">0</span>, nums, f, g);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, mask = <span class="number">0</span>, cur = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            ans[i] = cur;</span><br><span class="line">            mask |= <span class="number">1</span> &lt;&lt; cur;</span><br><span class="line">            cur = g[mask][cur];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> mask, <span class="type">int</span> pre, <span class="type">int</span>[] nums, <span class="type">int</span>[][] f, <span class="type">int</span>[][] g)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">if</span> (mask == (<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span> || f[mask][pre] != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> f[mask][pre];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((mask &gt;&gt; i &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> dfs(mask | <span class="number">1</span> &lt;&lt; i, i, nums, f, g) + Math.abs(pre - nums[i]);</span><br><span class="line">                <span class="keyword">if</span> (cur &lt; res) &#123;</span><br><span class="line">                    res = cur;</span><br><span class="line">                    g[mask][pre] = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> f[mask][pre] = res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-13T11:02:05.914Z" title="2024/5/13 下午7:02:05">2024-05-13</time>发表</span><span class="level-item"><time dateTime="2024-05-13T11:03:06.563Z" title="2024/5/13 下午7:03:06">2024-05-13</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span> / </span><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/AtCoder/">AtCoder</a></span><span class="level-item">1 分钟读完 (大约119个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/13/AtCoder%20Beginner%20Contest%20350/">AtCoder Beginner Contest 350</a></p><div class="content"><h2 id="Sort"><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/abc350/tasks/abc350_c">Sort</a></h2>
<h3 id="题目">题目</h3>
<p>输入长度为 \(n\) 的数组 \(a\)，表示从 \(1\) 到 \(n\) 的排列。输出操作的次数和过程，使得排列有序。每次操作可以交换 \(a_{i}\) 和 \(a_{j}\)，其中 \(1\leq i&lt;j\leq n\)。</p>
<p>数据范围：\(2\leq n\leq 2\times 10^{5}\)。</p>
<h3 id="思路">思路</h3>
<p>如果 \(a_{i}=i\)，则说明 \(a_{i}\) 在正确的位置上。否则，\(a_{i}\) 应该移动到位置 \(a_{i}\) 上，即交换下标 \(i\) 和 \(a_{i}\) 的值。这样每次交换都至少使得一个数在正确的位置上，最多交换 \(n-1\) 次，时间复杂度为 \(O(n)\)。PS：太久没做题，竟然没有做出来。比赛时多此一举，使用的是下标数组 + 排序做的，其实也没问题，就是最后没有按照大小顺序输出。</p>
<h3 id="代码">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> io.nextInt();</span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        a[i] = io.nextInt() - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;<span class="type">int</span>[]&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (a[i] != i) &#123;</span><br><span class="line">            ans.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;Math.min(i, a[i]), Math.max(i, a[i])&#125;);</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> a[a[i]]; a[a[i]] = a[i]; a[i] = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    io.println(ans.size());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> t : ans) &#123;</span><br><span class="line">        io.println((t[<span class="number">0</span>] + <span class="number">1</span>) + <span class="string">&quot; &quot;</span> + (t[<span class="number">1</span>] + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-13T10:59:29.137Z" title="2024/5/13 下午6:59:29">2024-05-13</time>发表</span><span class="level-item"><time dateTime="2024-05-13T11:09:22.984Z" title="2024/5/13 下午7:09:22">2024-05-13</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span> / </span><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/LeetCode/">LeetCode</a></span><span class="level-item">6 分钟读完 (大约934个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/13/%E7%AC%AC%20394%20%E5%9C%BA%E5%8A%9B%E6%89%A3%E5%91%A8%E8%B5%9B/">第 394 场力扣周赛</a></p><div class="content"><h2 id="使矩阵满足条件的最少操作次数"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-number-of-operations-to-satisfy-conditions/">使矩阵满足条件的最少操作次数</a></h2>
<h3 id="题目">题目</h3>
<p>输入 \(m\times n\) 的矩阵 \(grid\)，输出需要的最少操作次数，使得每列的值相等，且相邻两列的值不相等。每次操作可以将任意单元格的值修改为任意非负整数。</p>
<p>数据范围：\(1\leq n,m\leq 1000\)，\(0\leq grid[i][j]\leq 9\)。</p>
<h3 id="思路">思路</h3>
<p>首先，每列的值肯定是修改为 \([0,9]\) 之间更优，因为操作次数可能更少。我们可以从前往后枚举每列修改为什么值，可以发现存在重叠子问题。定义 \(dp[i][j]\) 表示将第 \(i\) 列修改为 \(j\)，使得 \([0,i]\) 列满足条件所需的最少操作次数。有状态转移方程 \(dp[i][j]=\min{(dp[i-1][k])}+cnt_{i,j}\)，其中 \(0\leq k\leq 9\) 且 \(k\neq j\)，\(cnt_{i,j}\) 表示将第 \(i\) 列修改为 \(j\) 所需的操作次数。时间复杂度为 \(O(mn+nU^{2})\)，空间复杂度为 \(O(nU)\)，其中 \(U\) 表示 \(grid[i][j]\) 的值域大小。<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-number-of-operations-to-satisfy-conditions/solutions/2749283/ji-yi-hua-sou-suo-pythonjavacgo-by-endle-8i0e/">灵神题解</a>提到一个优化方式，状态转移只会从前面所有列操作的最优值或者次优值转移过来，利用这个特性可以降低时间和空间复杂度。</p>
<h3 id="代码">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumOperations</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> grid.length, n = grid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span>[][] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[n][<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                cnt[j][grid[i][j]]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>][<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            Arrays.fill(dp[i], Integer.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">10</span>; k++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (k != j) &#123;</span><br><span class="line">                        dp[i + <span class="number">1</span>][j] = Math.min(dp[i + <span class="number">1</span>][j], dp[i][k] + (m - cnt[i][j]));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            ans = Math.min(ans, dp[n][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最短路径中的边"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-edges-in-shortest-paths/">最短路径中的边</a></h2>
<h3 id="题目-2">题目</h3>
<p>输入整数 \(n\) 和长度为 \(m\) 的数组 \(edges\)，表示包含 \(n\) 个节点和 \(m\) 条边的无向带权图（无重边和自环）。输出长度为 \(m\) 的布尔数组 \(ans\)，如果从节点 \(0\) 到节点 \(n-1\) 的所有最短路中包含 \(edges[i]\)，则 \(ans[i]=true\)。</p>
<p>数据范围：\(2\leq n\leq 5\times 10^{4}\)，\(1\leq m\leq\min{(5\times 10^{4},\frac{n(n-1)}{2})}\)，\(1\leq w_{i}\leq 10^{5}\)。</p>
<h3 id="思路-2">思路</h3>
<p>首先使用 Dijkstra 算法求出从节点 \(0\) 到所有其他节点的最短路，然后暴力的想法是以节点 \(0\) 为起点使用 DFS 回溯来遍历图，遍历的同时存储路径上的边，当到达节点 \(n-1\) 的路径长度等于最短路时，则将该路径上的边都置为 \(true\)。回溯理论上最坏情况下的时间复杂度为 \(O(n\times n!)\)，但是可以通过力扣的测试，因为可以利用最短路的限制进行剪枝，至于能否构造出 Hack 回溯的测试用例，我不太清楚。</p>
<p>正确的解法是使用两次 Dijkstra 算法，分别求出从节点 \(0\) 到所有其他节点的最短路，和从节点 \(n-1\) 到所有其他节点的最短路。然后枚举每一条边，判断路径长度 \(d_{0,u}+w_{u,v}+d_{v,n-1}\) 或者 \(d_{0,v}+w_{u,v}+d_{u,n-1}\) 是否等于最短路，从而可以得出该边是否在某个最短路中。</p>
<p>另一种做法是只对起点使用一次 Dijkstra 算法，然后从终点反向 DFS，经过的边如果满足 \(d_{0,v}+w_{u,v}=d_{0,u}\)，则说明该边在某个最短路上。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-03-10T11:14:50.503Z" title="2024/3/10 下午7:14:50">2024-03-10</time>发表</span><span class="level-item"><time dateTime="2024-03-10T11:16:45.497Z" title="2024/3/10 下午7:16:45">2024-03-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span> / </span><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/LeetCode/">LeetCode</a></span><span class="level-item">3 分钟读完 (大约472个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/10/%E7%AC%AC%20388%20%E5%9C%BA%E5%8A%9B%E6%89%A3%E5%91%A8%E8%B5%9B/">第 388 场力扣周赛</a></p><div class="content"><h2 id="K-个不相交子数组的最大能量值"><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-strength-of-k-disjoint-subarrays/">K 个不相交子数组的最大能量值</a></h2>
<h3 id="题目">题目</h3>
<p>输入长度为 \(n\) 的整数数组 \(nums\) 和正奇数 \(k\)，输出从数组中选择 \(k\) 个不相交的子数组，能够得到的最大得分。\(k\) 个子数组的得分为 \(\sum_{i=1}^{k}(-1)^{i+1}\times sum[i]\times (k-i+1)\)，其中 \(sum[i]\) 表示第 \(i\) 个子数组中元素之和。</p>
<p>数据范围：\(1\leq n\leq 10^{4}\)，\(-10^{9}\leq nums[i]\leq 10^{9}\)，\(1\leq k\leq n\)，\(1\leq n\times k\leq 10^{6}\)。</p>
<h3 id="思路">思路</h3>
<p>定义 \(dp[i][r]\) 表示从区间 \([0,r-1]\) 选择 \(i\) 个不相交子数组，能够得到的最大得分。对于元素 \(nums[r-1]\)，我们有选或者不选两种情况，状态转移方程如下：</p>
<div>
$$
dp[i][r]=\max(dp[i][r-1],\max_{l=i-1}^{r-1}(dp[i-1][l]+(sum[r]-sum[l])\times (-1)^{i+1}\times (k-i+1)))
$$
</div>
<p>初始时，对于所有 \(0\leq i\leq n\)，有 \(dp[0][i]=0\)，其他值初始化为负无穷。使用上述转移方程，时间复杂度为 \(O(kn^{2})\)。可以对其变形，将时间复杂度优化为 \(O(kn)\)，详细参见<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-strength-of-k-disjoint-subarrays/solutions/2678061/qian-zhui-he-hua-fen-xing-dpshi-zi-bian-ap5z5/">灵神的题解</a>。<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximum-strength-of-k-disjoint-subarrays/solutions/2678091/xiao-yang-xiao-en-xian-duan-shang-de-zhu-ea5g/">小羊的题解</a>使用的是另一种做法，似乎更简洁，但是看不太懂啊。</p>
<h3 id="代码">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">maximumStrength</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">long</span>[] sum = <span class="keyword">new</span> <span class="title class_">long</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            sum[i + <span class="number">1</span>] = sum[i] + nums[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span>[][] dp = <span class="keyword">new</span> <span class="title class_">long</span>[k + <span class="number">1</span>][n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= k; i++) &#123;</span><br><span class="line">            Arrays.fill(dp[i], Long.MIN_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">max</span> <span class="operator">=</span> Long.MIN_VALUE;</span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> (<span class="number">2</span> * (i &amp; <span class="number">1</span>) - <span class="number">1</span>) * -<span class="number">1</span> * (k - i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> i; r &lt; n - (k - i - <span class="number">1</span>); r++) &#123;</span><br><span class="line">                max = Math.max(max, dp[i][r] - sum[r] * w);</span><br><span class="line">                dp[i + <span class="number">1</span>][r + <span class="number">1</span>] = Math.max(dp[i + <span class="number">1</span>][r], sum[r + <span class="number">1</span>] * w + max);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[k][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-03-10T11:13:00.612Z" title="2024/3/10 下午7:13:00">2024-03-10</time>发表</span><span class="level-item"><time dateTime="2024-03-10T11:14:26.473Z" title="2024/3/10 下午7:14:26">2024-03-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span> / </span><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/AtCoder/">AtCoder</a></span><span class="level-item">2 分钟读完 (大约362个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/03/10/AtCoder%20Beginner%20Contest%20344/">AtCoder Beginner Contest 344</a></p><div class="content"><h2 id="String-Bags"><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/abc344/tasks/abc344_d">String Bags</a></h2>
<h3 id="题目">题目</h3>
<p>输入字符串 \(T\) 和整数 \(N\)，表示有 \(N\) 个袋子。然后对每个袋子，输入其包含的字符串个数 \(A_{i}\)，以及 \(A_{i}\) 个字符串 \(S_{i,1},S_{i,2},\dots,S_{i,A_{i}}\)。对于每个袋子，我们只能从中选择一个字符串或者不选。输出选择袋子的最少个数，使得按照袋子的编号顺序拼接字符串，能够得到字符串 \(T\)。如果无法得到字符串 \(T\)，则输出 \(-1\)。</p>
<p>数据范围：\(1\leq \operatorname{len}(T)\leq 100\)，\(1\leq N\leq 100\)，\(1\leq A_{i}\leq 10\)，\(1\leq \operatorname{len}(S_{i,j})\leq 10\)。</p>
<h3 id="思路">思路</h3>
<p>定义 \(dp[i][j]\) 表示从袋子 \([1,i]\) 中选择袋子的最少个数，使得拼接得到的字符串和 \(T\) 的前缀 \([1,j]\) 相同（下标从 \(1\) 开始）。初始状态和转移方程见代码，算是基本的动态规划，太久没做题加上原题表述有歧义，竟然没做出来。</p>
<h3 id="代码">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">t</span> <span class="operator">=</span> io.next();</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> io.nextInt();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> t.length();</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m + <span class="number">1</span>];</span><br><span class="line">    Arrays.fill(dp, m + <span class="number">1</span>);</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">z</span> <span class="operator">=</span> io.nextInt();</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; z; j++) &#123;</span><br><span class="line">            set.add(io.next());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> m - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">1</span>; k &lt;= <span class="number">10</span> &amp;&amp; k &lt;= j + <span class="number">1</span>; k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (set.contains(t.substring(j - k + <span class="number">1</span>, j + <span class="number">1</span>))) &#123;</span><br><span class="line">                    dp[j + <span class="number">1</span>] = Math.min(dp[j + <span class="number">1</span>], dp[j + <span class="number">1</span> - k] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    io.println(dp[m] == m + <span class="number">1</span> ? -<span class="number">1</span> : dp[m]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-28T05:01:59.396Z" title="2024/2/28 下午1:01:59">2024-02-28</time>发表</span><span class="level-item"><time dateTime="2024-02-28T05:09:33.609Z" title="2024/2/28 下午1:09:33">2024-02-28</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E4%B9%A6%E7%B1%8D/">书籍</a><span> / </span><a class="link-muted" href="/categories/%E4%B9%A6%E7%B1%8D/DDIA/">DDIA</a></span><span class="level-item">17 分钟读完 (大约2564个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/28/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%8C%91%E6%88%98/">分布式系统的挑战</a></p><div class="content"><h2 id="不可靠的网络">不可靠的网络</h2>
<p>网络分区故障，指网络的一部分由于网络故障而与其他部分断开，其实可以直接称为网络故障。作者推荐，可以通过故意触发网络问题，来测试系统的反应。</p>
<p>在分布式系统中，需要设置响应的超时时间，从而判断节点是否失效。如果时间设置得太长，则需要等待更长的时间。如果时间设置得太短，可能节点只是负载过高而响应缓慢，此时判断节点失效并将负载转移到其他节点会进一步增加系统负载，从而可能导致失效扩散（还可能会导致其他异常）。比较好的做法是，持续测量响应时间及其变化，然后根据测量结果自动调整超时时间。</p>
<p>从广义上讲，网络延迟的波动可以视为资源动态分配的结果。传统的电话网络（非 VoIP）使用电路交换技术，为每个通话分配一条固定带宽的通信链路，网络的延迟是确定的；而互联网使用分组交换技术，所有用户共享网络带宽，用户之间的数据存在排队的情况，该方法可以增加带宽的利用率，但是理论上的延迟是无限大的。</p>
<h2 id="不可靠的时钟">不可靠的时钟</h2>
<p>网络上的每台机器都有独立的时钟硬件设备，通常是石英晶体振荡器，用于维护机器的本地时间，该时间可能与其他机器上的时间不同。通常使用网络时间协议（Network Time Protocol，NTP）来同步机器之间的时间，该协议根据一组专门的时间服务器来调整本地时间（调整石英的振动频率），时间服务器则从精确度更高的时间源（例如 GPS 接收器）获取高精度时间。</p>
<h3 id="墙上时钟和单调时钟">墙上时钟和单调时钟</h3>
<p>现代计算机内部至少有两种时钟：墙上时钟和单调时钟。</p>
<p><strong>墙上时钟</strong></p>
<p>墙上时钟根据某个日期返回当前的日期与时间，例如 Linux 的 <code>clock_gettime(CLOCK_REALTIME)</code> 和 Java 的 <code>System.currentTimeMillis()</code> 会返回自 1970 年 1月 1 日（UTC）以来的秒数和毫秒数，不含润秒。有些系统则使用其他日期作为参考点。</p>
<p>墙上时钟需要使用 NTP 进行同步，但是存在很多问题。特别是，如果本地时钟远远快于 NTP 服务器，则同步之后会发生时间倒退的现象，以及墙上时钟经常忽略润秒，导致其不太适合用于测量时间间隔。</p>
<p><strong>单调时钟</strong></p>
<p>单调时钟不需要和 NTP 服务器时钟进行同步，适合测量时间间隔。例如 Linux 的 <code>clock_gettime(CLOCK_MONOTONIC)</code> 和 Java 中的 <code>System.nanoTime()</code> 返回的都是单调时钟。单调时钟的单个值没有任何意义，它可能是电脑启动后经过的纳秒数或者其他含义，不同节点上的单调时钟没有相同的基准，不能相互比较。</p>
<h3 id="时钟同步和准确性">时钟同步和准确性</h3>
<p>硬件时钟和 NTP 服务器可能会出现各种问题，例如：计算机中的石英钟存在漂移现象（运行速度会加快或减慢，取决于机器的温度）；如果本地时钟和 NTP 服务器时钟相差太大，应用程序可能会看到时间倒退或跳跃的现象；同步的准确性受限于网络延迟，以及 NTP 服务器是否正常工作；各种其他情况，包括下面提到的润秒。</p>
<p>润秒（Leap second）就是对协调世界时（Coordinated Universal Time，UTC）增加或减少 1 秒，以使协调世界时和世界时（UT，通常指 UT1）之间的差异不超过 0.9 秒。2022 年 11 月，国际计量大会决定在 2035 年之前取消润秒。润秒曾经使许多大型系统崩溃，根本原因是许多系统没有正确适配润秒，软件存在 BUG 从而引发各种问题。可以看下 <a target="_blank" rel="noopener" href="https://www.wired.com/2012/07/leap-second-glitch-explained/">The Inside Story of the Extra Second That Crashed the Web</a> 这篇文章，讲述了现实中发生过的问题。Google 处理润秒方式是，在一天内逐步调整时间，而不是在一天结束时直接改变 1 秒。PS：一个显示各个时钟目前时间的<a target="_blank" rel="noopener" href="http://leapsecond.com/java/gpsclock.htm">网站</a>。</p>
<p>如果投入大量资源，可以达到非常高的时钟精度，例如交易系统的时钟就要求很小的时钟误差。高精度的时钟可以使用 GPS 接收器，精确时间协议（PTP）并辅以细致的部署和监测来实现。</p>
<h3 id="依赖同步的时钟">依赖同步的时钟</h3>
<p>如果应用需要精确同步的时钟，最好仔细监控所有节点上的时钟偏差。如果某个节点的时钟漂移超出上限，则将其视为失效节点并从集群中移除。这样监控的目的是确保在造成重大影响（例如隐式的数据丢失）之前尽早发现并处理问题。</p>
<p><strong>时间戳和事件顺序</strong></p>
<p>在无主复制的检测并发写中提到过，最后写入者获胜（LWW）冲突解决策略由于时钟偏差，可能会覆盖非并发写入。</p>
<p><img src="/img/DDIA.assets/1704193039170.jpg" alt=""></p>
<p>在上述例子中，时钟同步机制稳定工作，节点 1 和节点 3 之间的时钟偏差小于 3ms，但是时间戳却不能正确排序事件，从而导致客户端 B 的增量操作被覆盖。解决方案就是之前提到过的，使用版本向量技术跟踪因果关系。PS：因果关系其实就是非并发写操作的前后关系，版本向量不仅可以跟踪因果关系，还可以判断写操作是否并发。</p>
<p><strong>时钟的置信区间</strong></p>
<p>或许墙上时钟会返回微秒甚至纳秒级别的信息，但是这种精度的测量值其实并不可信，因为存在石英漂移和网络延迟等不确定性因素。所以，我们不应该将时钟读数视为一个精确的时间点，而应该视为带有置信区间的时间范围。例如，系统可能有 95% 的置信度认为目前时间介于 10.3~10.5 秒之间。</p>
<p>可以根据具体的时间源来推算出时钟误差的上限。如果节点上直接装有 GPS 接收器或原子（铯）时钟，那它的误差范围通常可查询制造商的手册。如果节点是从服务器获取时间，则不确定性取决于上次同步以来的石英漂移范围，加上 NTP 服务器的不确定性，再加上节点和服务器之间的往返时间。</p>
<p>但是，大多数系统并不提供这种误差查询接口，通常只会返回某个确定的时间，而没有任何误差信息。Google Spanner 中的 TrueTime API 提供误差查询，它会返回时间的上下界。</p>
<p><strong>全局快照的同步时钟</strong></p>
<p>该节主要是讲如何在分布式场景下，生成全局单调递增的事务 ID，有点不明白这个标题是什么意思。如果是单节点数据库，使用一个计数器就可以实现正确的事务 ID。但是，如果是多节点数据库，则更加复杂并且开销更大。</p>
<p>Twitter 使用雪花（Snowflake）算法来生成近似单调递增的唯一 ID。如果节点之间的墙上时钟完全同步，则也可以将其作为事务 ID，但是实际上是不可能的。Google Spanner 使用 TrueTime API 返回的时钟置信区间作为事务 ID，如果两个置信区间没有重叠，则可以知道两个事务的先后顺序。</p>
<h3 id="进程暂停">进程暂停</h3>
<p>在使用主从复制的数据库中，只有主节点可以接受写入，如果主节点失效则需要将某个从节点提升为主节点。判断节点是否失效可以使用租约来实现：如果某个节点持有租约，那么它就是主节点；如果租约过期，则该节点失效。我们可以使用单调时钟来判断租约是否过期，但是可能由于垃圾收集、上下文切换或磁盘 I/O 等原因导致进程暂停，从而使得暂停之前判断租约没有过期，暂停之后发送请求时租约已经过期。</p>
<p><img src="/img/DDIA.assets/1709093091191.png" alt=""></p>
<p>上图是 HBase 曾经遇到的问题，不正确的分布式锁实现，导致未持有锁的客户端修改数据。解决方案是，锁服务为每个锁维护一个单调递增的 fencing 令牌（实际上就是版本号），在锁服务授予客户端租约和客户端向存储服务发送写请求时会包含该令牌，存储服务也会维护数据最后一次修改对应的令牌。如果存储服务收到的写请求包含旧令牌，则会拒绝该请求。如果使用 ZooKeeper 作为锁服务，则事务标识 zxid 或节点版本 cversion 可以充当 fencing 令牌。</p>
<p><img src="/img/DDIA.assets/1709093912140.png" alt=""></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-21T04:02:24.236Z" title="2024/2/21 下午12:02:24">2024-02-21</time>发表</span><span class="level-item"><time dateTime="2024-02-21T04:05:39.911Z" title="2024/2/21 下午12:05:39">2024-02-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span> / </span><a class="link-muted" href="/categories/%E7%AE%97%E6%B3%95/Codeforces/">Codeforces</a></span><span class="level-item">6 分钟读完 (大约938个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/21/think-cell%20Round%201/">think-cell Round 1</a></p><div class="content"><h2 id="Permutation-Printing"><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1930/problem/B">Permutation Printing</a></h2>
<h3 id="题目">题目</h3>
<p>输入一个整数 \(n\)，输出长度为 \(n\) 的排列，满足不存在两个不同的索引 \(1\leq i,j&lt; n\)，使得 \(p_{i}\) 整除 \(p_{j}\) 且 \(p_{i+1}\) 整除 \(p_{j+1}\)。</p>
<p>数据范围：\(3\leq n\leq 10^{5}\)。</p>
<h3 id="思路">思路</h3>
<p>可以构造排列 \(1,n,2,n-1,\dots,\lceil\frac{n+1}{2}\rceil\)。如果 \(i&lt;j\)，则有 \(p_{i+1}&gt;p_{j+1}\)，必定不能整除，反之亦然。</p>
<h3 id="代码">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> io.nextInt();</span><br><span class="line">    <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">1</span>, r = n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            io.print(l++ + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            io.print(r-- + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    io.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Lexicographically-Largest"><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1930/problem/C">Lexicographically Largest</a></h2>
<h3 id="题目-2">题目</h3>
<p>输入长度为 \(n\) 的数组 \(a\)，初始时有一个空集 \(S\)，执行以下三步操作恰好 \(n\) 次：</p>
<ul>
<li>选择一个索引 \(i\)，\(1\leq i\leq |a|\)。</li>
<li>将 \(a_{i}+i\) 插入集合 \(S\)。</li>
<li>从 \(a\) 中删除 \(a_{i}\)，\(a_{i}\) 之后的所有元素的索引将减少 \(1\)。</li>
</ul>
<p>将得到的集合 \(S\) 中的元素按照递减顺序排列，输出能够得到的字典序最大的排列。</p>
<p>数据范围：\(1\leq n\leq 3\cdot 10^{5}\)，\(1\leq a_{i}\leq 10^{9}\)。</p>
<h3 id="思路-2">思路</h3>
<p>可以发现字典序最大的排列总是包含 \(n\) 个元素。暴力的想法是，可以首先将所有 \(a_{i}+i\) 从小到大排序，我们总是优先选择最大的元素，如果有多个元素最大，就优先选择其中索引 \(i\) 最小的元素，从而可以保证得到字典序最大的排列。通过观察可以发现，如果从小到大排列 \(a_{i}+i\)，然后倒序遍历数组，我们可以得到的最大元素为 \(\min(a[i],a[i+1]-1)\)，对所有 \(1\leq i&lt; n\) 都成立。比赛时没发现，使用的是更复杂的方法，其实不难。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> io.nextInt();</span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        a[i] = io.nextInt();</span><br><span class="line">        a[i] += i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Arrays.sort(a);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        a[i] = Math.min(a[i], a[i + <span class="number">1</span>] - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        io.print(a[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    io.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Sum-over-all-Substrings-Hard-Version"><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1930/problem/D2">Sum over all Substrings (Hard Version)</a></h2>
<h3 id="题目-3">题目</h3>
<p>输入长度为 \(n\) 的二进制字符串 \(s\)，输出 \(\sum_{i=1}^{n}\sum_{j=i}^{n}f(s_{i}s_{i+1}\cdots s_{j})\)。对于某个二进制模式串 \(p\)，\(f(p)\) 表示满足以下条件的二进制字符串 \(q\)，其中 \(1\) 的最小可能数量：假设 \(p\) 和 \(q\) 的长度均为 \(m\)，对于所有 \(1\leq i\leq m\)，存在 \(l\) 和 \(r\)（\(1\leq l\leq i\leq r\leq m\)），使得 \(p_{i}\) 在 \(q_{l}q_{l+1}\cdots q_{r}\) 中的出现次数至少为 \(\lceil \frac{m}{2}\rceil\)。</p>
<p>数据范围：\(1\leq n\leq 10^{6}\)。</p>
<h3 id="思路-3">思路</h3>
<p>暴力的想法是枚举所有子串，然后对于每个子串计算 \(f\) 值。现在思考对于给定的 \(p\)，如何计算 \(f\) 值。正序遍历子串，基本算法如下：如果 \(p_{i}=0\)，则直接在 \(q_{i}\) 放置 \(0\)；如果 \(p_{i}=1\)，则可以在 \(q_{i+1}\) 放置 \(1\)，\(q_{i}\) 和 \(q_{i+2}\) 放置 \(0\)，从而不论 \(p_{i+1}\) 和 \(p_{i+2}\) 是什么，都存在满足条件的 \(l\) 和 \(r\)（在区间 \([i,i+2]\) 范围内）。时间复杂度为 \(O(n^{3})\)，如果在遍历的同时计算子串，则时间复杂度为 \(O(n^{2})\)。可以使用动态规划将时间复杂度降低为 \(O(n)\)，定义 \(dp_{i}\) 表示 \(\sum_{j=i}^{n}f(s_{i}s_{i+1}\cdots s_{j})\)，转移方程见代码。</p>
<h3 id="代码-2">代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> io.nextInt();</span><br><span class="line">    <span class="type">char</span>[] s = io.next().toCharArray();</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="type">long</span>[] dp = <span class="keyword">new</span> <span class="title class_">long</span>[n + <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">            dp[i] = dp[i + <span class="number">3</span>] + n - i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dp[i] = dp[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ans += dp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    io.println(ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/13/">13</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/dark_souls.jpg" alt="Ligh0x74"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Ligh0x74</p><p class="is-size-6 is-block">Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">121</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">19</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">8</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Ligh0x74" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Ligh0x74"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://ppoffice.github.io/hexo-theme-icarus/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ICARUS</span></span><span class="level-right"><span class="level-item tag">ppoffice.github.io</span></span></a></li><li><a class="level is-mobile" href="https://waline.js.org" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Waline</span></span><span class="level-right"><span class="level-item tag">waline.js.org</span></span></a></li><li><a class="level is-mobile" href="https://vercel.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Vercel</span></span><span class="level-right"><span class="level-item tag">vercel.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E4%B9%A6%E7%B1%8D/"><span class="level-start"><span class="level-item">书籍</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E4%B9%A6%E7%B1%8D/DDIA/"><span class="level-start"><span class="level-item">DDIA</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E5%85%B6%E4%BB%96/"><span class="level-start"><span class="level-item">其他</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">基础</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%9F%BA%E7%A1%80/%E6%A8%A1%E6%9D%BF/"><span class="level-start"><span class="level-item">模板</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E5%AE%9E%E9%AA%8C/"><span class="level-start"><span class="level-item">实验</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/OceanBase/"><span class="level-start"><span class="level-item">OceanBase</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">算法</span></span><span class="level-end"><span class="level-item tag">88</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%AE%97%E6%B3%95/AtCoder/"><span class="level-start"><span class="level-item">AtCoder</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%AE%97%E6%B3%95/Codeforces/"><span class="level-start"><span class="level-item">Codeforces</span></span><span class="level-end"><span class="level-item tag">34</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%AE%97%E6%B3%95/LeetCode/"><span class="level-start"><span class="level-item">LeetCode</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E7%B3%BB%E7%BB%9F/"><span class="level-start"><span class="level-item">系统</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">语言</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E8%AF%AD%E8%A8%80/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%AD%E8%A8%80/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B/"><span class="level-start"><span class="level-item">课程</span></span><span class="level-end"><span class="level-item tag">15</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B/CMU-15-445/"><span class="level-start"><span class="level-item">CMU 15-445</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AF%BE%E7%A8%8B/MIT-6-824/"><span class="level-start"><span class="level-item">MIT 6.824</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-08-14T04:01:18.128Z">2024-08-14</time></p><p class="title"><a href="/2024/08/14/%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%20%E8%AF%BE%E7%A8%8B%202022/">南京大学 操作系统 课程 2022</a></p><p class="categories"><a href="/categories/%E7%B3%BB%E7%BB%9F/">系统</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-08-12T14:19:35.532Z">2024-08-12</time></p><p class="title"><a href="/2024/08/12/%E5%8D%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%20%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C%202022/">南京大学 计算机系统基础 课程实验 2022</a></p><p class="categories"><a href="/categories/%E5%AE%9E%E9%AA%8C/">实验</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-05-14T07:56:20.438Z">2024-05-14</time></p><p class="title"><a href="/2024/05/14/%E7%AC%AC%20130%20%E5%9C%BA%E5%8A%9B%E6%89%A3%E5%A4%9C%E5%96%B5%E5%8F%8C%E5%91%A8%E8%B5%9B%EF%BC%88VP%EF%BC%89/">第 130 场力扣夜喵双周赛（VP）</a></p><p class="categories"><a href="/categories/%E7%AE%97%E6%B3%95/">算法</a> / <a href="/categories/%E7%AE%97%E6%B3%95/LeetCode/">LeetCode</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-05-13T11:03:22.872Z">2024-05-13</time></p><p class="title"><a href="/2024/05/13/%E7%AC%AC%20397%20%E5%9C%BA%E5%8A%9B%E6%89%A3%E5%91%A8%E8%B5%9B/">第 397 场力扣周赛</a></p><p class="categories"><a href="/categories/%E7%AE%97%E6%B3%95/">算法</a> / <a href="/categories/%E7%AE%97%E6%B3%95/LeetCode/">LeetCode</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-05-13T11:02:05.914Z">2024-05-13</time></p><p class="title"><a href="/2024/05/13/AtCoder%20Beginner%20Contest%20350/">AtCoder Beginner Contest 350</a></p><p class="categories"><a href="/categories/%E7%AE%97%E6%B3%95/">算法</a> / <a href="/categories/%E7%AE%97%E6%B3%95/AtCoder/">AtCoder</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">95</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/I-O/"><span class="tag">I/O</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"><span class="tag">动态规划</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E8%AE%BA/"><span class="tag">图论</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"><span class="tag">字符串</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8E%92%E5%BA%8F/"><span class="tag">排序</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E5%AD%A6/"><span class="tag">数学</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="tag">数据结构</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://clist.by/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CLIST</span></span><span class="level-right"><span class="level-item tag">clist.by</span></span></a></li><li><a class="level is-mobile" href="https://tech.meituan.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">美团技术团队</span></span><span class="level-right"><span class="level-item tag">tech.meituan.com</span></span></a></li><li><a class="level is-mobile" href="https://www.ruanyifeng.com/blog/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">阮一峰的网络日志</span></span><span class="level-right"><span class="level-item tag">www.ruanyifeng.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Ligh0x74&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Ligh0x74</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>